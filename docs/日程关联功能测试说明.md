# 日程关联功能测试说明

## 功能概述

日程管理现已支持关联客户和案件，方便用户将日程与具体业务对象关联起来。

## 已实现的功能

### 1. ✅ 关联客户 - 编辑页面可选择关联客户

**位置**：日程编辑页面 (`/pages/other/customer/schedule/edit`)

**功能说明**：
- 在"关联对象"区域可以选择关联类型：无、客户、案件
- 选择"客户"后，会显示"选择客户"按钮
- 点击按钮可以选择要关联的客户（当前为演示模式）

**测试步骤**：
1. 进入日程编辑页面（新建或编辑）
2. 找到"关联对象"区域
3. 点击"客户"标签
4. 点击"选择客户"按钮
5. 在弹窗中点击"模拟选择"
6. 确认显示"客户A公司"

### 2. ✅ 关联案件 - 编辑页面可选择关联案件

**位置**：日程编辑页面 (`/pages/other/customer/schedule/edit`)

**功能说明**：
- 在"关联对象"区域可以选择"案件"
- 选择"案件"后，会显示"选择案件"按钮
- 点击按钮可以选择要关联的案件（当前为演示模式）

**测试步骤**：
1. 进入日程编辑页面（新建或编辑）
2. 找到"关联对象"区域
3. 点击"案件"标签
4. 点击"选择案件"按钮
5. 在弹窗中点击"模拟选择"
6. 确认显示"民事诉讼案件"

### 3. ✅ 查看关联关系 - 详情页显示并支持跳转

**位置**：日程详情页面 (`/pages/other/customer/schedule/detail`)

**功能说明**：
- 如果日程关联了客户或案件，会在详情页底部显示关联信息卡片
- 卡片显示关联类型和名称
- 点击卡片可以跳转到对应的详情页面

**测试步骤**：
1. 创建一个关联了客户的日程
2. 保存后进入详情页
3. 滚动到底部，找到"关联客户"卡片
4. 确认显示客户名称和右箭头
5. 点击卡片，跳转到客户详情页

## Mock 数据说明

Mock 数据中已有部分日程设置了关联信息：

```javascript
{
  id: 1,
  title: '与客户A洽谈合同',
  related_type: 'customer',
  related_id: 10,
  // ...
}
```

可以直接查看 ID 为 1 的日程来测试关联显示功能。

## 注意事项

### 当前限制

1. **选择器为演示模式**：
   - 客户选择器和案件选择器当前使用模态框模拟
   - 实际项目中需要实现完整的选择器组件

2. **案件详情页待开发**：
   - 点击关联案件时会提示"案件详情页面待开发"
   - 需要后续实现案件详情页面

3. **关联信息来源**：
   - 优先使用 `related_info.name`
   - 如果没有，则显示 `类型 #ID` 格式

### 数据验证

编辑页面会验证：
- 如果选择了关联类型，必须选择具体的关联对象
- 否则会提示"请选择关联客户/案件"

## 后续优化建议

1. **实现完整的选择器组件**：
   - 客户选择器：支持搜索、分页、多选等
   - 案件选择器：支持按状态筛选、搜索等

2. **优化关联信息显示**：
   - 显示更多关联对象的详细信息
   - 支持快速操作（如拨打电话、发送消息等）

3. **支持更多关联类型**：
   - 客户计划
   - 拜访记录
   - 合同等

4. **关联关系管理**：
   - 支持修改关联关系
   - 支持取消关联
   - 显示关联历史

## 技术实现说明

### 数据结构

```typescript
interface Schedule {
  // ...其他字段
  related_type?: 'case' | 'customer' | 'customer_plan' | 'visit'
  related_id?: number
  related_info?: {
    id: number
    name: string
    // 其他信息
  }
}
```

### 关键代码位置

- **编辑页面**：`src/pages/other/customer/schedule/edit.vue`
  - `onSelectRelatedType()` - 切换关联类型
  - `onSelectCustomer()` - 选择客户
  - `onSelectCase()` - 选择案件

- **详情页面**：`src/pages/other/customer/schedule/detail.vue`
  - `getRelatedTypeText()` - 获取关联类型文本
  - `getRelatedName()` - 获取关联对象名称
  - `onViewRelated()` - 跳转到关联对象详情

- **类型定义**：`src/types/interfaces/schedule.ts`
  - `RelatedType` - 关联类型枚举
  - `Schedule` - 日程接口定义
