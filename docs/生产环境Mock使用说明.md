# ç”Ÿäº§ç¯å¢ƒMockä½¿ç”¨è¯´æ˜

## é—®é¢˜æè¿°

åœ¨ç”Ÿäº§ç¯å¢ƒæ„å»ºæ—¶ï¼Œå³ä½¿è®¾ç½®äº† `VITE_USE_MOCK=true`ï¼ŒMockæ•°æ®ä»ç„¶ä¸ç”Ÿæ•ˆã€‚

## é—®é¢˜åŸå› 

1. **Mockæ³¨å†Œé€»è¾‘é—®é¢˜**ï¼šåŸæ¥çš„ä»£ç åªåœ¨å¼€å‘ç¯å¢ƒï¼ˆ`import.meta.env.DEV`ï¼‰ä¸‹æ³¨å†ŒMockå¤„ç†å™¨
2. **ç¯å¢ƒå˜é‡è¯»å–é—®é¢˜**ï¼šç”Ÿäº§ç¯å¢ƒçš„ç¯å¢ƒå˜é‡è¯»å–å¯èƒ½å­˜åœ¨é—®é¢˜

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®æ”¹Mockæ³¨å†Œé€»è¾‘

å·²ä¿®æ”¹ `src/main.ts` ä¸­çš„Mockæ³¨å†Œé€»è¾‘ï¼š

```typescript
// ä¿®æ”¹å‰ï¼šåªåœ¨å¼€å‘ç¯å¢ƒæ³¨å†Œ
if (import.meta.env.DEV) {
  setupMockHandlers()
}

// ä¿®æ”¹åï¼šæ ¹æ®ç¯å¢ƒå˜é‡æ§åˆ¶
const envConfig = getEnvConfig()
if (envConfig.useMock) {
  console.log('ğŸ”§ å¯ç”¨ Mock æ¨¡å¼ï¼Œæ­£åœ¨æ³¨å†Œ Mock å¤„ç†å™¨...')
  setupMockHandlers()
} else {
  console.log('ğŸŒ ä½¿ç”¨çœŸå® API æ¨¡å¼')
}
```

### 2. ä¼˜åŒ–ç¯å¢ƒå˜é‡è¯»å–é€»è¾‘

å·²ä¿®æ”¹ `src/utils/env.ts` ä¸­çš„ `useMock` é€»è¾‘ï¼š

```typescript
// ä¿®æ”¹å‰
useMock: env.VITE_USE_MOCK === 'true' || isDevelopment,

// ä¿®æ”¹åï¼šä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œå¼€å‘ç¯å¢ƒé»˜è®¤ä¸ºtrue
useMock: env.VITE_USE_MOCK === 'true' || (isDevelopment && env.VITE_USE_MOCK !== 'false'),
```

### 3. æ·»åŠ ç¯å¢ƒè°ƒè¯•å·¥å…·

åˆ›å»ºäº† `src/utils/debug-env.ts` ç”¨äºè°ƒè¯•ç¯å¢ƒå˜é‡ï¼š

```typescript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†çš„ç¯å¢ƒå˜é‡ä¿¡æ¯
debugEnvConfig()
```

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨ä¸“é—¨çš„Mockæ„å»ºè„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# æ„å»ºç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬ï¼Œå¯ç”¨Mock
pnpm build:h5:mock
```

### æ–¹æ³•2ï¼šåˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶

1. åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```bash
# ç¯å¢ƒæ ‡è¯†
VITE_ENV=production

# APIæ¥å£åœ°å€
VITE_API_URL=https://api.example.com

# å¯ç”¨Mockæ•°æ®
VITE_USE_MOCK=true

# å…¶ä»–é…ç½®...
VITE_USE_PROXY=false
VITE_USE_VCONSOLE=false
VITE_SOURCEMAP=false
VITE_OUTPUT_DIR=dist
```

2. ä½¿ç”¨æ ‡å‡†æ„å»ºå‘½ä»¤ï¼š

```bash
pnpm build:h5
```

### æ–¹æ³•3ï¼šå‘½ä»¤è¡Œä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡

```bash
# Windows PowerShell
$env:VITE_USE_MOCK="true"; pnpm build:h5

# Windows CMD
set VITE_USE_MOCK=true && pnpm build:h5

# Linux/Mac
VITE_USE_MOCK=true pnpm build:h5
```

## éªŒè¯Mockæ˜¯å¦ç”Ÿæ•ˆ

### 1. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º

æ„å»ºåè¿è¡Œåº”ç”¨ï¼ŒæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼š

```
=== ç¯å¢ƒå˜é‡è°ƒè¯•ä¿¡æ¯ ===
import.meta.env: {MODE: "production", DEV: false, PROD: true, VITE_USE_MOCK: "true", ...}
getEnvConfig(): {useMock: true, isDev: false, isProd: true, ...}
Mock é…ç½®è¯¦æƒ…: {useMock: true, isDev: false, isProd: true, env: "production"}

ğŸ”§ å¯ç”¨ Mock æ¨¡å¼ï¼Œæ­£åœ¨æ³¨å†Œ Mock å¤„ç†å™¨...
=== Mock ç³»ç»Ÿåˆå§‹åŒ– ===
æ‰€æœ‰ Mock å¤„ç†å™¨: [...]
Mock å¤„ç†å™¨å·²æ³¨å†Œï¼Œå…± X ä¸ªæ¥å£
```

### 2. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networké¢æ¿ä¸­ï¼š
- Mockè¯·æ±‚ä¼šæ˜¾ç¤ºä¸ºæœ¬åœ°è¯·æ±‚
- å“åº”æ•°æ®æ¥è‡ªMockå¤„ç†å™¨
- ä¸ä¼šå‘é€çœŸå®çš„HTTPè¯·æ±‚

### 3. æŸ¥çœ‹è¯·æ±‚æ—¥å¿—

Mockè¯·æ±‚ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºï¼š

```
ğŸš€ å‘èµ·è¯·æ±‚ ====> {url: "/api/xxx", method: "get", isMock: true, ...}
ğŸ“¦ æ¨¡æ‹Ÿæ•°æ®å“åº” <==== {url: "/api/xxx", data: {...}}
```

## æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒMockä»…ç”¨äºæ¼”ç¤º**ï¼šç”Ÿäº§ç¯å¢ƒé€šå¸¸ä¸åº”è¯¥å¯ç”¨Mockï¼Œä»…ç”¨äºæ¼”ç¤ºæˆ–æµ‹è¯•ç›®çš„

2. **ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§**ï¼š`VITE_USE_MOCK=true` ä¼šè¦†ç›–é»˜è®¤è®¾ç½®

3. **è°ƒè¯•ä¿¡æ¯**ï¼šç”Ÿäº§ç¯å¢ƒä¼šè¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼Œæ­£å¼å‘å¸ƒå‰å¯ä»¥ç§»é™¤

4. **Mockæ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿æ‰€æœ‰éœ€è¦çš„APIéƒ½æœ‰å¯¹åº”çš„Mockå¤„ç†å™¨

## æ•…éšœæ’é™¤

### Mockä¸ç”Ÿæ•ˆçš„å¸¸è§åŸå› 

1. **ç¯å¢ƒå˜é‡æœªæ­£ç¡®è®¾ç½®**ï¼šæ£€æŸ¥ `.env.production` æ–‡ä»¶æˆ–å‘½ä»¤è¡Œå‚æ•°
2. **Mockå¤„ç†å™¨æœªæ³¨å†Œ**ï¼šæŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰"å¯ç”¨ Mock æ¨¡å¼"çš„æ—¥å¿—
3. **APIè·¯å¾„ä¸åŒ¹é…**ï¼šæ£€æŸ¥Mockå¤„ç†å™¨çš„URLæ¨¡å¼æ˜¯å¦æ­£ç¡®
4. **æ„å»ºç¼“å­˜é—®é¢˜**ï¼šæ¸…é™¤ `dist` ç›®å½•åé‡æ–°æ„å»º

### è°ƒè¯•æ­¥éª¤

1. è¿è¡Œ `pnpm build:h5:mock` æ„å»ºé¡¹ç›®
2. å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨é¢„è§ˆæ„å»ºç»“æœ
3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
4. æŸ¥çœ‹æ§åˆ¶å°çš„ç¯å¢ƒå˜é‡è°ƒè¯•ä¿¡æ¯
5. æ£€æŸ¥Mockå¤„ç†å™¨æ³¨å†Œæ—¥å¿—
6. æµ‹è¯•APIè¯·æ±‚ï¼ŒæŸ¥çœ‹Mockå“åº”

## ç›¸å…³æ–‡ä»¶

- `src/main.ts` - Mockæ³¨å†Œé€»è¾‘
- `src/utils/env.ts` - ç¯å¢ƒå˜é‡è¯»å–
- `src/utils/debug-env.ts` - ç¯å¢ƒè°ƒè¯•å·¥å…·
- `src/utils/request.ts` - Mockè¯·æ±‚å¤„ç†
- `src/mock/index.ts` - Mockå¤„ç†å™¨æ³¨å†Œ
