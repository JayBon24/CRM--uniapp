### 微信小程序分享按钮使用说明（uni-app Vue3）

本文档说明在微信小程序端，如何使用原生分享按钮 `button open-type="share"` 正确发起分享，并在页面中自定义分享内容。H5/App 端不适用该方式，请使用各自平台分享方案。

---

#### 一、为什么要用 open-type="share"
- 微信小程序不支持直接通过 `uni.share` API 进行分享。
- 需使用原生分享触发：
  - 页面右上角分享菜单
  - 页面内自定义按钮 `<button open-type="share">`

---

#### 二、最小示例（推荐）

模板（仅小程序端生效，使用条件编译保护）：
```vue
<template>
  <!-- #ifdef MP-WEIXIN -->
  <button open-type="share" class="share-button">分享给好友</button>
  <!-- #endif -->
</template>
```

脚本（Vue3 <script setup>）：
```ts
<script setup lang="ts">
import { onShareAppMessage } from '@dcloudio/uni-app'

// 注册小程序的分享回调（右上角/按钮都会走这里）
onShareAppMessage(() => {
  return {
    title: '自定义分享标题',
    path: '/pages/exhibition/detail?id=123', // 必须以/开头的完整页面路径
    imageUrl: '' // 可选：自定义分享封面图
  }
})
</script>
```

样式（示例）：
```css
.share-button {
  width: 100%;
  height: 80rpx;
  background-color: #007aff;
  color: #fff;
  border-radius: 8rpx;
}
```

---

#### 三、页面右上角分享
- 若需启用页面右上角的“转发”按钮，可在页面生命周期中调用：
```ts
import { onLoad } from '@dcloudio/uni-app'

onLoad(() => {
  // 小程序端显示右上角分享按钮
  // @ts-ignore
  wx?.showShareMenu?.({ withShareTicket: false, menus: ['shareAppMessage', 'shareTimeline'] })
})
```
- 并可额外注册朋友圈分享（可选）：
```ts
import { onShareTimeline } from '@dcloudio/uni-app'

onShareTimeline(() => {
  return {
    title: '分享到朋友圈标题',
    query: 'id=123',
    imageUrl: ''
  }
})
```

---

#### 四、跨平台兼容建议
- 小程序端：使用 `open-type="share"` + `onShareAppMessage(onShareTimeline)`
- H5/App 端：可继续使用 `uni.share` 或第三方分享方案
- 可使用条件编译避免报错：
```ts
// #ifdef MP-WEIXIN
// 小程序分享逻辑
// #endif

// #ifndef MP-WEIXIN
// 其他平台（如App/H5）分享逻辑
// #endif
```

---

#### 五、常见问题排查
- 按钮不生效/不显示：
  - 确认当前运行平台是“微信小程序”。
  - 确认使用了原生 `<button open-type="share">`，不要包裹在 `<text>` 内；建议直接用 `view/button`。
  - 确认 `onShareAppMessage` 已在该“页面”中注册（组件内注册无效，必须在页面文件）。
  - 检查有无遮罩/绝对定位元素覆盖了按钮，导致无法点击。
- 分享内容未更新：
  - `onShareAppMessage` 返回的对象需要是“函数返回值”，且在触发时计算；不要写成固定变量且未更新。
- 路径无效：
  - `path` 必须是以 `/` 开头的完整页面路径，参数使用 `?a=1&b=2`。
- 朋友圈分享：
  - 须 `wx.showShareMenu({ menus: ['shareAppMessage','shareTimeline'] })` 并实现 `onShareTimeline`。

---

#### 六、完整示例（页面内按钮 + 右上角菜单）
```vue
<template>
  <view class="page">
    <!-- #ifdef MP-WEIXIN -->
    <button open-type="share" class="share-button">分享给好友</button>
    <!-- #endif -->
  </view>
</template>

<script setup lang="ts">
import { onLoad, onShareAppMessage, onShareTimeline } from '@dcloudio/uni-app'

onLoad(() => {
  // #ifdef MP-WEIXIN
  // 展示右上角分享菜单（含朋友圈）
  // @ts-ignore
  wx?.showShareMenu?.({ withShareTicket: false, menus: ['shareAppMessage', 'shareTimeline'] })
  // #endif
})

// 好友/群聊分享
onShareAppMessage(() => ({
  title: '邀请您加入展览',
  path: '/pages/exhibition/join-role?exhibitionId=10001&role=worker',
  imageUrl: ''
}))

// 朋友圈分享（可选）
onShareTimeline?.(() => ({
  title: '展览活动火热进行中',
  query: 'exhibitionId=10001'
}))
</script>

<style scoped>
.share-button{ width: 100%; height: 88rpx; background: #2979ff; color:#fff; border-radius: 10rpx; }
</style>
```

---

#### 七、与已有代码的关系
- 本项目中 `src/pages/exhibition/role-management.vue`、`src/pages/exhibition/join-role.vue` 等已采用条件编译与页面级分享回调方式；建议统一到以上最佳实践。
- 在组件（如 `ExhibitionListItem`）中不要直接注册 `onShareAppMessage`，而是由“页面”承载分享逻辑。

---

#### 八、参考
- uni-app 文档：`分享`（`https://uniapp.dcloud.net.cn/api/plugins/share.html`）
- 微信小程序文档：`open-type="share"`、`Page.onShareAppMessage`、`wx.showShareMenu`