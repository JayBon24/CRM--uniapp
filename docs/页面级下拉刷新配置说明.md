# 页面级下拉刷新配置说明

## 1. pages.json 配置

要使用页面级下拉刷新，需要在 `pages.json` 中为对应页面启用下拉刷新功能：

```json
{
  "pages": [
    {
      "path": "pages/example/pull-refresh",
      "style": {
        "navigationBarTitleText": "页面级下拉刷新",
        "enablePullDownRefresh": true,
        "backgroundTextStyle": "dark",
        "backgroundColor": "#f5f5f5"
      }
    }
  ]
}
```

## 2. 关键配置项说明

### enablePullDownRefresh
- **类型**: `boolean`
- **默认值**: `false`
- **说明**: 是否开启下拉刷新功能

### backgroundTextStyle
- **类型**: `string`
- **可选值**: `"dark"` | `"light"`
- **默认值**: `"dark"`
- **说明**: 下拉刷新时显示的文字颜色

### backgroundColor
- **类型**: `string`
- **默认值**: `"#ffffff"`
- **说明**: 下拉刷新时的背景色

## 3. 实现步骤

### 步骤1: 导入生命周期钩子
```typescript
import { onPullDownRefresh } from '@dcloudio/uni-app'
```

### 步骤2: 监听下拉刷新事件
```typescript
onPullDownRefresh(() => {
  // 执行刷新逻辑
  handleRefresh().finally(() => {
    // 停止下拉刷新动画
    uni.stopPullDownRefresh()
  })
})
```

### 步骤3: 实现刷新逻辑
```typescript
const handleRefresh = async () => {
  // 重置数据
  pageNum.value = 1
  hasMore.value = true
  
  // 重新加载数据
  await loadData()
  
  // 显示成功提示
  uni.showToast({
    title: '刷新成功',
    icon: 'none' 
  })
}
```

## 4. 注意事项

1. **必须调用 stopPullDownRefresh()**
   - 刷新完成后必须调用此方法停止下拉刷新动画
   - 建议在 `finally` 块中调用，确保无论成功失败都能停止

2. **错误处理**
   - 网络请求失败时也要停止刷新动画
   - 提供用户友好的错误提示

3. **性能优化**
   - 避免重复触发刷新
   - 可以添加防抖机制

4. **用户体验**
   - 提供加载状态提示
   - 刷新成功后给出反馈

## 5. 与 scroll-view 方式的区别

| 特性 | 页面级下拉刷新 | scroll-view 下拉刷新 |
|------|----------------|---------------------|
| 实现方式 | onPullDownRefresh 钩子 | scroll-view 组件属性 |
| 配置要求 | pages.json 配置 | 组件属性配置 |
| 刷新范围 | 整个页面 | scroll-view 内容区 |
| 自定义程度 | 系统提供的样式 | 可自定义刷新样式 |
| 兼容性 | 全平台支持 | 部分平台限制 |
| 性能 | 较好 | 更好 |

## 6. 适用场景

### 适合使用页面级下拉刷新的场景：
- 简单的列表页面
- 不需要自定义刷新样式
- 需要刷新整个页面内容
- 对刷新动画要求不高

### 推荐使用 scroll-view 下拉刷新的场景：
- 复杂的页面布局
- 需要同时支持上拉加载
- 需要自定义刷新样式
- 对性能有较高要求

## 7. 完整示例

详细实现请参考 `页面级下拉刷新示例.vue` 文件。